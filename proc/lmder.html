<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   
   <meta name="description" content="Modernized Minpack">
    
    <meta name="author" content="Jacob Williams" >
    <link rel="icon" href="../favicon.png">

    <title>lmder &ndash; minpack</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">minpack </a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
        
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
          
              
            <li><a href="../lists/files.html">Source Files</a></li>
        
        
        
            <li><a href="../lists/modules.html">Modules</a></li>
        
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
        
        
            <li><a href="../lists/absint.html">Abstract Interfaces</a></li>
               
               
        
        
            </ul>
        
            </li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/absint.html">Abstract Interfaces</a></li>
                             



          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>lmder
      <small>Subroutine</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
    data-placement="bottom" data-html="true"
    title=" 9.9% of total for procedures.">184 statements</a>
     </li> 
     
     
     
    <li><i class="fa fa-code"></i><a href="../src/minpack.f90"> Source File</a></li>
     
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
    
     <li><a href='../sourcefile/minpack.f90.html'>minpack.f90</a></li>
    
     <li><a href='../module/minpack_module.html'>minpack_module</a></li>
    
  
     <li class="active">lmder</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  
<h3>Contents</h3>
 





















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../proc/lmder.html#src">lmder</a>
  </div>
</div>



</div>

    </div>
    
    <div class="col-md-9" id='text'>
    <h2>
public subroutine lmder(fcn, m, n, x, Fvec, Fjac, Ldfjac, Ftol, Xtol, Gtol, Maxfev, Diag, Mode, Factor, Nprint, Info, Nfev, Njev, Ipvt, Qtf, Wa1, Wa2, Wa3, Wa4)
    
    
   
</h2>
    
  


    
    <p>the purpose of lmder is to minimize the sum of the squares of
m nonlinear functions in n variables by a modification of
the levenberg-marquardt algorithm. the user must provide a
subroutine which calculates the functions and the jacobian.</p>
    

    <h3>Arguments</h3>
    
      
<table class="table table-striped varlist">
<thead><tr><th>Type</th>
<th>Intent</th><th>Optional</th>
<th>Attributes</th><th></th><th>Name</th><th></th></thead>



<tbody>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-fcn~7"></span>procedure(<a href='../interface/fcn_lmder.html'>fcn_lmder</a>)</td>
  <td></td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>fcn</strong></td><td><p>the user-supplied subroutine which
calculates the functions and the jacobian</p></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-m~6"></span>integer,</td>
  <td>intent(in)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>m</strong></td><td><p>a positive integer input variable set to the number
of functions.</p></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-n~15"></span>integer,</td>
  <td>intent(in)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>n</strong></td><td><p>a positive integer input variable set to the number
of variables. n must not exceed m.</p></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-x~15"></span>real(kind=wp),</td>
  <td>intent(inout)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>x</strong>(n)</td><td><p>an array of length n. on input x must contain
an initial estimate of the solution vector. on output x
contains the final estimate of the solution vector.</p></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-fvec~6"></span>real(kind=wp),</td>
  <td>intent(out)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>Fvec</strong>(m)</td><td><p>an output array of length m which contains
the functions evaluated at the output x.</p></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-fjac~6"></span>real(kind=wp),</td>
  <td>intent(out)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>Fjac</strong>(Ldfjac,n)</td><td><p>an output m by n array. the upper n by n submatrix
 of fjac contains an upper triangular matrix r with
 diagonal elements of nonincreasing magnitude such that</p>
<div class="codehilite"><pre><span></span><code>        t     t           t
       p *(jac *jac)*p = r *r,
</code></pre></div>

<p>where p is a permutation matrix and jac is the final
 calculated jacobian. column j of p is column ipvt(j)
 (see below) of the identity matrix. the lower trapezoidal
 part of fjac contains information generated during
 the computation of r.</p></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-ldfjac~6"></span>integer,</td>
  <td>intent(in)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>Ldfjac</strong></td><td><p>a positive integer input variable not less than m
which specifies the leading dimension of the array fjac.</p></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-ftol"></span>real(kind=wp),</td>
  <td>intent(in)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>Ftol</strong></td><td><p>a nonnegative input variable. termination
occurs when both the actual and predicted relative
reductions in the sum of squares are at most ftol.
therefore, ftol measures the relative error desired
in the sum of squares.</p></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-xtol~2"></span>real(kind=wp),</td>
  <td>intent(in)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>Xtol</strong></td><td><p>a nonnegative input variable. termination
occurs when the relative error between two consecutive
iterates is at most xtol. therefore, xtol measures the
relative error desired in the approximate solution.</p></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-gtol"></span>real(kind=wp),</td>
  <td>intent(in)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>Gtol</strong></td><td><p>a nonnegative input variable. termination
occurs when the cosine of the angle between fvec and
any column of the jacobian is at most gtol in absolute
value. therefore, gtol measures the orthogonality
desired between the function vector and the columns
of the jacobian.</p></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-maxfev~2"></span>integer,</td>
  <td>intent(in)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>Maxfev</strong></td><td><p>a positive integer input variable. termination
occurs when the number of calls to fcn with iflag = 1
has reached maxfev.</p></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-diag~3"></span>real(kind=wp),</td>
  <td>intent(inout)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>Diag</strong>(n)</td><td><p>an array of length n. if mode = 1 (see
below), diag is internally set. if mode = 2, diag
must contain positive entries that serve as
multiplicative scale factors for the variables.</p></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-mode~3"></span>integer,</td>
  <td>intent(in)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>Mode</strong></td><td><p>an integer input variable. if mode = 1, the
variables will be scaled internally. if mode = 2,
the scaling is specified by the input diag. other
values of mode are equivalent to mode = 1.</p></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-factor~2"></span>real(kind=wp),</td>
  <td>intent(in)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>Factor</strong></td><td><p>a positive input variable used in determining the
initial step bound. this bound is set to the product of
factor and the euclidean norm of diag*x if nonzero, or else
to factor itself. in most cases factor should lie in the
interval (.1,100.).100. is a generally recommended value.</p></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-nprint~2"></span>integer,</td>
  <td>intent(in)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>Nprint</strong></td><td><p>an integer input variable that enables controlled
printing of iterates if it is positive. in this case,
fcn is called with iflag = 0 at the beginning of the first
iteration and every nprint iterations thereafter and
immediately prior to return, with x, fvec, and fjac
available for printing. fvec and fjac should not be
altered. if nprint is not positive, no special calls
of fcn with iflag = 0 are made.</p></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-info~3"></span>integer,</td>
  <td>intent(out)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>Info</strong></td><td><p>an integer output variable. if the user has
terminated execution, info is set to the (negative)
value of iflag. see description of fcn. otherwise,
info is set as follows:</p>
<ul>
<li><strong><em>info = 0</em></strong>  improper input parameters.</li>
<li><strong><em>info = 1</em></strong>  both actual and predicted relative reductions
   in the sum of squares are at most ftol.</li>
<li><strong><em>info = 2</em></strong>  relative error between two consecutive iterates
   is at most xtol.</li>
<li><strong><em>info = 3</em></strong>  conditions for info = 1 and info = 2 both hold.</li>
<li><strong><em>info = 4</em></strong>  the cosine of the angle between fvec and any
   column of the jacobian is at most gtol in
   absolute value.</li>
<li><strong><em>info = 5</em></strong>  number of calls to fcn with iflag = 1 has
   reached maxfev.</li>
<li><strong><em>info = 6</em></strong>  ftol is too small. no further reduction in
   the sum of squares is possible.</li>
<li><strong><em>info = 7</em></strong>  xtol is too small. no further improvement in
   the approximate solution x is possible.</li>
<li><strong><em>info = 8</em></strong>  gtol is too small. fvec is orthogonal to the
   columns of the jacobian to machine precision.</li>
</ul></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-nfev~2"></span>integer,</td>
  <td>intent(out)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>Nfev</strong></td><td><p>an integer output variable set to the number of
calls to fcn with iflag = 1.</p></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-njev~2"></span>integer,</td>
  <td>intent(out)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>Njev</strong></td><td><p>an integer output variable set to the number of
calls to fcn with iflag = 2.</p></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-ipvt"></span>integer,</td>
  <td>intent(out)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>Ipvt</strong>(n)</td><td><p>an integer output array of length n. ipvt
defines a permutation matrix p such that jac<em>p = q</em>r,
where jac is the final calculated jacobian, q is
orthogonal (not stored), and r is upper triangular
with diagonal elements of nonincreasing magnitude.
column j of p is column ipvt(j) of the identity matrix.</p></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-qtf~2"></span>real(kind=wp),</td>
  <td>intent(out)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>Qtf</strong>(n)</td><td><p>an output array of length n which contains
the first n elements of the vector (q transpose)*fvec.</p></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-wa1~4"></span>real(kind=wp),</td>
  <td>intent(inout)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>Wa1</strong>(n)</td><td><p>work array of length n.</p></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-wa2~4"></span>real(kind=wp),</td>
  <td>intent(inout)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>Wa2</strong>(n)</td><td><p>work array of length n.</p></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-wa3~2"></span>real(kind=wp),</td>
  <td>intent(inout)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>Wa3</strong>(n)</td><td><p>work array of length n.</p></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-wa4~2"></span>real(kind=wp),</td>
  <td>intent(inout)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>Wa4</strong>(m)</td><td><p>work array of length n.</p></td>
  
</tr>

</tbody>
</table>

    
    
    
    <br>
    
    
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">Calls</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: proc~~lmder~~CallsGraph Pages: 1 -->
<svg id="proclmderCallsGraph" width="242pt" height="52pt"
 viewBox="0.00 0.00 242.00 52.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="proc~~lmder~~CallsGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 48)">
<title>proc~~lmder~~CallsGraph</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-48 238,-48 238,4 -4,4"/>
<!-- proc~lmder -->
<g id="proc~~lmder~~CallsGraph_node1" class="node">
<title>proc~lmder</title>
<polygon fill="none" stroke="black" points="54,-24 0,-24 0,0 54,0 54,-24"/>
<text text-anchor="middle" x="27" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">lmder</text>
</g>
<!-- proc~qrfac -->
<g id="proc~~lmder~~CallsGraph_node2" class="node">
<title>proc~qrfac</title>
<g id="a_proc~~lmder~~CallsGraph_node2"><a xlink:href=".././proc/qrfac.html" xlink:title="qrfac">
<polygon fill="#d9534f" stroke="#d9534f" points="144,-44 90,-44 90,-20 144,-20 144,-44"/>
<text text-anchor="middle" x="117" y="-29.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">qrfac</text>
</a>
</g>
</g>
<!-- proc~lmder&#45;&gt;proc~qrfac -->
<g id="proc~~lmder~~CallsGraph_edge1" class="edge">
<title>proc~lmder&#45;&gt;proc~qrfac</title>
<path fill="none" stroke="#000000" d="M54.4,-18C62.48,-19.84 71.51,-21.89 80.1,-23.84"/>
<polygon fill="#000000" stroke="#000000" points="79.39,-27.27 89.92,-26.07 80.94,-20.44 79.39,-27.27"/>
</g>
<!-- proc~enorm -->
<g id="proc~~lmder~~CallsGraph_node3" class="node">
<title>proc~enorm</title>
<g id="a_proc~~lmder~~CallsGraph_node3"><a xlink:href=".././proc/enorm.html" xlink:title="enorm">
<polygon fill="#d94e8f" stroke="#d94e8f" points="234,-24 180,-24 180,0 234,0 234,-24"/>
<text text-anchor="middle" x="207" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">enorm</text>
</a>
</g>
</g>
<!-- proc~lmder&#45;&gt;proc~enorm -->
<g id="proc~~lmder~~CallsGraph_edge2" class="edge">
<title>proc~lmder&#45;&gt;proc~enorm</title>
<path fill="none" stroke="#000000" d="M54.24,-11.48C65.28,-11.29 78.27,-11.09 90,-11 114,-10.81 120,-10.81 144,-11 152.25,-11.07 161.12,-11.18 169.49,-11.31"/>
<polygon fill="#000000" stroke="#000000" points="169.7,-14.82 179.76,-11.48 169.81,-7.82 169.7,-14.82"/>
</g>
<!-- proc~qrfac&#45;&gt;proc~enorm -->
<g id="proc~~lmder~~CallsGraph_edge3" class="edge">
<title>proc~qrfac&#45;&gt;proc~enorm</title>
<path fill="none" stroke="#000000" d="M144.4,-26C152.48,-24.16 161.51,-22.11 170.1,-20.16"/>
<polygon fill="#000000" stroke="#000000" points="170.94,-23.56 179.92,-17.93 169.39,-16.73 170.94,-23.56"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="597pt" height="32pt"
 viewBox="0.00 0.00 596.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-28 592.5,-28 592.5,4 -4,4"/>
<!-- Subroutine -->
<g id="node1" class="node">
<title>Subroutine</title>
<polygon fill="#d9534f" stroke="#d9534f" points="70,-24 0,-24 0,0 70,0 70,-24"/>
<text text-anchor="middle" x="35" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Subroutine</text>
</g>
<!-- Function -->
<g id="node2" class="node">
<title>Function</title>
<polygon fill="#d94e8f" stroke="#d94e8f" points="146,-24 88,-24 88,0 146,0 146,-24"/>
<text text-anchor="middle" x="117" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Function</text>
</g>
<!-- Interface -->
<g id="node3" class="node">
<title>Interface</title>
<polygon fill="#a7506f" stroke="#a7506f" points="225.5,-24 164.5,-24 164.5,0 225.5,0 225.5,-24"/>
<text text-anchor="middle" x="195" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Interface</text>
</g>
<!-- Unknown Procedure Type -->
<g id="node4" class="node">
<title>Unknown Procedure Type</title>
<polygon fill="#777777" stroke="#777777" points="388.5,-24 243.5,-24 243.5,0 388.5,0 388.5,-24"/>
<text text-anchor="middle" x="316" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Unknown Procedure Type</text>
</g>
<!-- Program -->
<g id="node5" class="node">
<title>Program</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="465,-24 407,-24 407,0 465,0 465,-24"/>
<text text-anchor="middle" x="436" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Program</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node6" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="588.5,-24 483.5,-24 483.5,0 588.5,0 588.5,-24"/>
<text text-anchor="middle" x="536" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a procedure to one which it calls. Dashed 
    arrows point from an interface to procedures which implement that interface.
    This could include the module procedures in a generic interface or the
    implementation in a submodule of an interface in a parent module.
    </p>
    </div></div></div></div>
      </div>
    </div>
     
     
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">Called by</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: proc~~lmder~~CalledByGraph Pages: 1 -->
<svg id="proclmderCalledByGraph" width="152pt" height="32pt"
 viewBox="0.00 0.00 152.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="proc~~lmder~~CalledByGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>proc~~lmder~~CalledByGraph</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-28 148,-28 148,4 -4,4"/>
<!-- proc~lmder -->
<g id="proc~~lmder~~CalledByGraph_node1" class="node">
<title>proc~lmder</title>
<polygon fill="none" stroke="black" points="144,-24 90,-24 90,0 144,0 144,-24"/>
<text text-anchor="middle" x="117" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">lmder</text>
</g>
<!-- proc~lmder1 -->
<g id="proc~~lmder~~CalledByGraph_node2" class="node">
<title>proc~lmder1</title>
<g id="a_proc~~lmder~~CalledByGraph_node2"><a xlink:href=".././proc/lmder1.html" xlink:title="lmder1">
<polygon fill="#d9534f" stroke="#d9534f" points="54,-24 0,-24 0,0 54,0 54,-24"/>
<text text-anchor="middle" x="27" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">lmder1</text>
</a>
</g>
</g>
<!-- proc~lmder1&#45;&gt;proc~lmder -->
<g id="proc~~lmder~~CalledByGraph_edge1" class="edge">
<title>proc~lmder1&#45;&gt;proc~lmder</title>
<path fill="none" stroke="#000000" d="M54.4,-12C62.39,-12 71.31,-12 79.82,-12"/>
<polygon fill="#000000" stroke="#000000" points="79.92,-15.5 89.92,-12 79.92,-8.5 79.92,-15.5"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="597pt" height="32pt"
 viewBox="0.00 0.00 596.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-28 592.5,-28 592.5,4 -4,4"/>
<!-- Subroutine -->
<g id="node1" class="node">
<title>Subroutine</title>
<polygon fill="#d9534f" stroke="#d9534f" points="70,-24 0,-24 0,0 70,0 70,-24"/>
<text text-anchor="middle" x="35" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Subroutine</text>
</g>
<!-- Function -->
<g id="node2" class="node">
<title>Function</title>
<polygon fill="#d94e8f" stroke="#d94e8f" points="146,-24 88,-24 88,0 146,0 146,-24"/>
<text text-anchor="middle" x="117" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Function</text>
</g>
<!-- Interface -->
<g id="node3" class="node">
<title>Interface</title>
<polygon fill="#a7506f" stroke="#a7506f" points="225.5,-24 164.5,-24 164.5,0 225.5,0 225.5,-24"/>
<text text-anchor="middle" x="195" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Interface</text>
</g>
<!-- Unknown Procedure Type -->
<g id="node4" class="node">
<title>Unknown Procedure Type</title>
<polygon fill="#777777" stroke="#777777" points="388.5,-24 243.5,-24 243.5,0 388.5,0 388.5,-24"/>
<text text-anchor="middle" x="316" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Unknown Procedure Type</text>
</g>
<!-- Program -->
<g id="node5" class="node">
<title>Program</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="465,-24 407,-24 407,0 465,0 465,-24"/>
<text text-anchor="middle" x="436" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Program</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node6" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="588.5,-24 483.5,-24 483.5,0 588.5,0 588.5,-24"/>
<text text-anchor="middle" x="536" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a procedure to one which it calls. Dashed 
    arrows point from an interface to procedures which implement that interface.
    This could include the module procedures in a generic interface or the
    implementation in a submodule of an interface in a parent module.
    </p>
    </div></div></div></div>
      </div>
    </div>
     
    <br>

    <section class="visible-xs visible-sm hidden-md">
      
<h3>Contents</h3>
 





















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../proc/lmder.html#src">lmder</a>
  </div>
</div>



    </section>
    <br class="visible-xs visible-sm hidden-md">

    

    
    
    
    
    

    
    
    
    
    


    
    
    
    <section>
    <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="highlight"><pre><span></span>    <span class="k">subroutine </span><span class="n">lmder</span><span class="p">(</span><span class="n">fcn</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Fvec</span><span class="p">,</span> <span class="n">Fjac</span><span class="p">,</span> <span class="n">Ldfjac</span><span class="p">,</span> <span class="n">Ftol</span><span class="p">,</span> <span class="n">Xtol</span><span class="p">,</span> <span class="n">Gtol</span><span class="p">,</span> <span class="n">Maxfev</span><span class="p">,</span> <span class="p">&amp;</span>
                     <span class="n">Diag</span><span class="p">,</span> <span class="n">Mode</span><span class="p">,</span> <span class="n">Factor</span><span class="p">,</span> <span class="n">Nprint</span><span class="p">,</span> <span class="n">Info</span><span class="p">,</span> <span class="n">Nfev</span><span class="p">,</span> <span class="n">Njev</span><span class="p">,</span> <span class="n">Ipvt</span><span class="p">,</span> <span class="n">Qtf</span><span class="p">,</span> <span class="p">&amp;</span>
                     <span class="n">Wa1</span><span class="p">,</span> <span class="n">Wa2</span><span class="p">,</span> <span class="n">Wa3</span><span class="p">,</span> <span class="n">Wa4</span><span class="p">)</span>

    <span class="k">implicit none</span>

<span class="k">    procedure</span><span class="p">(</span><span class="n">fcn_lmder</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fcn</span> <span class="c">!! the user-supplied subroutine which</span>
                                <span class="c">!! calculates the functions and the jacobian</span>
    <span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">m</span> <span class="c">!! a positive integer input variable set to the number</span>
                            <span class="c">!! of functions.</span>
    <span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">n</span> <span class="c">!! a positive integer input variable set to the number</span>
                            <span class="c">!! of variables. n must not exceed m.</span>
    <span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Ldfjac</span> <span class="c">!! a positive integer input variable not less than m</span>
                                 <span class="c">!! which specifies the leading dimension of the array fjac.</span>
    <span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Maxfev</span> <span class="c">!! a positive integer input variable. termination</span>
                                 <span class="c">!! occurs when the number of calls to fcn with iflag = 1</span>
                                 <span class="c">!! has reached maxfev.</span>
    <span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Mode</span> <span class="c">!! an integer input variable. if mode = 1, the</span>
                                <span class="c">!! variables will be scaled internally. if mode = 2,</span>
                                <span class="c">!! the scaling is specified by the input diag. other</span>
                                <span class="c">!! values of mode are equivalent to mode = 1.</span>
    <span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Nprint</span> <span class="c">!! an integer input variable that enables controlled</span>
                                 <span class="c">!! printing of iterates if it is positive. in this case,</span>
                                 <span class="c">!! fcn is called with iflag = 0 at the beginning of the first</span>
                                 <span class="c">!! iteration and every nprint iterations thereafter and</span>
                                 <span class="c">!! immediately prior to return, with x, fvec, and fjac</span>
                                 <span class="c">!! available for printing. fvec and fjac should not be</span>
                                 <span class="c">!! altered. if nprint is not positive, no special calls</span>
                                 <span class="c">!! of fcn with iflag = 0 are made.</span>
    <span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Info</span> <span class="c">!! an integer output variable. if the user has</span>
                                <span class="c">!! terminated execution, info is set to the (negative)</span>
                                <span class="c">!! value of iflag. see description of fcn. otherwise,</span>
                                <span class="c">!! info is set as follows:</span>
                                <span class="c">!!</span>
                                <span class="c">!!  * ***info = 0***  improper input parameters.</span>
                                <span class="c">!!  * ***info = 1***  both actual and predicted relative reductions</span>
                                <span class="c">!!    in the sum of squares are at most ftol.</span>
                                <span class="c">!!  * ***info = 2***  relative error between two consecutive iterates</span>
                                <span class="c">!!    is at most xtol.</span>
                                <span class="c">!!  * ***info = 3***  conditions for info = 1 and info = 2 both hold.</span>
                                <span class="c">!!  * ***info = 4***  the cosine of the angle between fvec and any</span>
                                <span class="c">!!    column of the jacobian is at most gtol in</span>
                                <span class="c">!!    absolute value.</span>
                                <span class="c">!!  * ***info = 5***  number of calls to fcn with iflag = 1 has</span>
                                <span class="c">!!    reached maxfev.</span>
                                <span class="c">!!  * ***info = 6***  ftol is too small. no further reduction in</span>
                                <span class="c">!!    the sum of squares is possible.</span>
                                <span class="c">!!  * ***info = 7***  xtol is too small. no further improvement in</span>
                                <span class="c">!!    the approximate solution x is possible.</span>
                                <span class="c">!!  * ***info = 8***  gtol is too small. fvec is orthogonal to the</span>
                                <span class="c">!!    columns of the jacobian to machine precision.</span>
    <span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Nfev</span> <span class="c">!! an integer output variable set to the number of</span>
                                <span class="c">!! calls to fcn with iflag = 1.</span>
    <span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Njev</span> <span class="c">!! an integer output variable set to the number of</span>
                                <span class="c">!! calls to fcn with iflag = 2.</span>
    <span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Ipvt</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="c">!! an integer output array of length n. ipvt</span>
                                   <span class="c">!! defines a permutation matrix p such that jac*p = q*r,</span>
                                   <span class="c">!! where jac is the final calculated jacobian, q is</span>
                                   <span class="c">!! orthogonal (not stored), and r is upper triangular</span>
                                   <span class="c">!! with diagonal elements of nonincreasing magnitude.</span>
                                   <span class="c">!! column j of p is column ipvt(j) of the identity matrix.</span>
    <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Ftol</span> <span class="c">!! a nonnegative input variable. termination</span>
                                <span class="c">!! occurs when both the actual and predicted relative</span>
                                <span class="c">!! reductions in the sum of squares are at most ftol.</span>
                                <span class="c">!! therefore, ftol measures the relative error desired</span>
                                <span class="c">!! in the sum of squares.</span>
    <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Xtol</span> <span class="c">!! a nonnegative input variable. termination</span>
                                <span class="c">!! occurs when the relative error between two consecutive</span>
                                <span class="c">!! iterates is at most xtol. therefore, xtol measures the</span>
                                <span class="c">!! relative error desired in the approximate solution.</span>
    <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Gtol</span> <span class="c">!! a nonnegative input variable. termination</span>
                                <span class="c">!! occurs when the cosine of the angle between fvec and</span>
                                <span class="c">!! any column of the jacobian is at most gtol in absolute</span>
                                <span class="c">!! value. therefore, gtol measures the orthogonality</span>
                                <span class="c">!! desired between the function vector and the columns</span>
                                <span class="c">!! of the jacobian.</span>
    <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Factor</span> <span class="c">!! a positive input variable used in determining the</span>
                                  <span class="c">!! initial step bound. this bound is set to the product of</span>
                                  <span class="c">!! factor and the euclidean norm of diag*x if nonzero, or else</span>
                                  <span class="c">!! to factor itself. in most cases factor should lie in the</span>
                                  <span class="c">!! interval (.1,100.).100. is a generally recommended value.</span>
    <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">x</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="c">!! an array of length n. on input x must contain</span>
                                   <span class="c">!! an initial estimate of the solution vector. on output x</span>
                                   <span class="c">!! contains the final estimate of the solution vector.</span>
    <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Fvec</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="c">!! an output array of length m which contains</span>
                                    <span class="c">!! the functions evaluated at the output x.</span>
    <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Fjac</span><span class="p">(</span><span class="n">Ldfjac</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="c">!! an output m by n array. the upper n by n submatrix</span>
                                            <span class="c">!! of fjac contains an upper triangular matrix r with</span>
                                            <span class="c">!! diagonal elements of nonincreasing magnitude such that</span>
                                            <span class="c">!!```</span>
                                            <span class="c">!!        t     t           t</span>
                                            <span class="c">!!       p *(jac *jac)*p = r *r,</span>
                                            <span class="c">!!```</span>
                                            <span class="c">!! where p is a permutation matrix and jac is the final</span>
                                            <span class="c">!! calculated jacobian. column j of p is column ipvt(j)</span>
                                            <span class="c">!! (see below) of the identity matrix. the lower trapezoidal</span>
                                            <span class="c">!! part of fjac contains information generated during</span>
                                            <span class="c">!! the computation of r.</span>
    <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Diag</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="c">!! an array of length n. if mode = 1 (see</span>
                                      <span class="c">!! below), diag is internally set. if mode = 2, diag</span>
                                      <span class="c">!! must contain positive entries that serve as</span>
                                      <span class="c">!! multiplicative scale factors for the variables.</span>
    <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Qtf</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="c">!! an output array of length n which contains</span>
                                   <span class="c">!! the first n elements of the vector (q transpose)*fvec.</span>
    <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Wa1</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="c">!! work array of length n.</span>
    <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Wa2</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="c">!! work array of length n.</span>
    <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Wa3</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="c">!! work array of length n.</span>
    <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Wa4</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="c">!! work array of length n.</span>

    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">iflag</span><span class="p">,</span> <span class="n">iter</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">l</span>
    <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">actred</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">dirder</span><span class="p">,</span> <span class="n">fnorm</span><span class="p">,</span> <span class="n">fnorm1</span><span class="p">,</span> <span class="n">gnorm</span><span class="p">,</span> <span class="n">par</span><span class="p">,</span> <span class="p">&amp;</span>
                <span class="n">pnorm</span><span class="p">,</span> <span class="n">prered</span><span class="p">,</span> <span class="n">ratio</span><span class="p">,</span> <span class="nb">sum</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">temp1</span><span class="p">,</span> <span class="n">temp2</span><span class="p">,</span> <span class="n">xnorm</span>

    <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">parameter</span> <span class="kd">::</span> <span class="n">p1</span> <span class="o">=</span> <span class="mf">1.0e-1_wp</span>
    <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">parameter</span> <span class="kd">::</span> <span class="n">p5</span> <span class="o">=</span> <span class="mf">5.0e-1_wp</span>
    <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">parameter</span> <span class="kd">::</span> <span class="n">p25</span> <span class="o">=</span> <span class="mf">2.5e-1_wp</span>
    <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">parameter</span> <span class="kd">::</span> <span class="n">p75</span> <span class="o">=</span> <span class="mf">7.5e-1_wp</span>
    <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">parameter</span> <span class="kd">::</span> <span class="n">p0001</span> <span class="o">=</span> <span class="mf">1.0e-4_wp</span>

    <span class="n">Info</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">iflag</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">Nfev</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">Njev</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c">! check the input parameters for errors.</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">m</span> <span class="o">&gt;=</span> <span class="n">n</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">Ldfjac</span> <span class="o">&gt;=</span> <span class="n">m</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">Ftol</span> <span class="o">&gt;=</span> <span class="n">zero</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">&amp;</span>
        <span class="n">Xtol</span> <span class="o">&gt;=</span> <span class="n">zero</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">Gtol</span> <span class="o">&gt;=</span> <span class="n">zero</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">Maxfev</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">&amp;</span>
        <span class="n">Factor</span> <span class="o">&gt;</span> <span class="n">zero</span><span class="p">)</span> <span class="k">then</span>
<span class="k">        if</span> <span class="p">(</span><span class="n">Mode</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="k">then</span>
<span class="k">            do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">Diag</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">zero</span><span class="p">)</span> <span class="k">goto </span><span class="mi">100</span>
            <span class="k">end do</span>
<span class="k">        end if</span>

        <span class="c">! evaluate the function at the starting point</span>
        <span class="c">! and calculate its norm.</span>

        <span class="n">iflag</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">call </span><span class="n">fcn</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Fvec</span><span class="p">,</span> <span class="n">Fjac</span><span class="p">,</span> <span class="n">Ldfjac</span><span class="p">,</span> <span class="n">iflag</span><span class="p">)</span>
        <span class="n">Nfev</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">iflag</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<span class="k">            </span><span class="n">fnorm</span> <span class="o">=</span> <span class="n">enorm</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">Fvec</span><span class="p">)</span>

            <span class="c">! initialize levenberg-marquardt parameter and iteration counter.</span>

            <span class="n">par</span> <span class="o">=</span> <span class="n">zero</span>
            <span class="n">iter</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="c">! beginning of the outer loop.</span>

            <span class="c">! calculate the jacobian matrix.</span>

<span class="mi">20</span>          <span class="n">iflag</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="k">call </span><span class="n">fcn</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Fvec</span><span class="p">,</span> <span class="n">Fjac</span><span class="p">,</span> <span class="n">Ldfjac</span><span class="p">,</span> <span class="n">iflag</span><span class="p">)</span>
            <span class="n">Njev</span> <span class="o">=</span> <span class="n">Njev</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">iflag</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>

                <span class="c">! if requested, call fcn to enable printing of iterates.</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">Nprint</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<span class="k">                    </span><span class="n">iflag</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">mod</span><span class="p">(</span><span class="n">iter</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Nprint</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">&amp;</span>
                            <span class="k">call </span><span class="n">fcn</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Fvec</span><span class="p">,</span> <span class="n">Fjac</span><span class="p">,</span> <span class="n">Ldfjac</span><span class="p">,</span> <span class="n">iflag</span><span class="p">)</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">iflag</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">goto </span><span class="mi">100</span>
                <span class="k">end if</span>

                <span class="c">! compute the qr factorization of the jacobian.</span>

                <span class="k">call </span><span class="n">qrfac</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">Fjac</span><span class="p">,</span> <span class="n">Ldfjac</span><span class="p">,</span> <span class="p">.</span><span class="n">true</span><span class="p">.,</span> <span class="n">Ipvt</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">Wa1</span><span class="p">,</span> <span class="n">Wa2</span><span class="p">,</span> <span class="n">Wa3</span><span class="p">)</span>

                <span class="c">! on the first iteration and if mode is 1, scale according</span>
                <span class="c">! to the norms of the columns of the initial jacobian.</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">iter</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<span class="k">                    if</span> <span class="p">(</span><span class="n">Mode</span> <span class="o">/=</span> <span class="mi">2</span><span class="p">)</span> <span class="k">then</span>
<span class="k">                        do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span>
                            <span class="n">Diag</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">Wa2</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">Wa2</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">==</span> <span class="n">zero</span><span class="p">)</span> <span class="n">Diag</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">one</span>
                        <span class="k">end do</span>
<span class="k">                    end if</span>

                    <span class="c">! on the first iteration, calculate the norm of the scaled x</span>
                    <span class="c">! and initialize the step bound delta.</span>

                    <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span>
                        <span class="n">Wa3</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">Diag</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                    <span class="k">end do</span>
<span class="k">                    </span><span class="n">xnorm</span> <span class="o">=</span> <span class="n">enorm</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">Wa3</span><span class="p">)</span>
                    <span class="n">delta</span> <span class="o">=</span> <span class="n">Factor</span><span class="o">*</span><span class="n">xnorm</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">delta</span> <span class="o">==</span> <span class="n">zero</span><span class="p">)</span> <span class="n">delta</span> <span class="o">=</span> <span class="n">Factor</span>
                <span class="k">end if</span>

                <span class="c">! form (q transpose)*fvec and store the first n components in</span>
                <span class="c">! qtf.</span>

                <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">m</span>
                    <span class="n">Wa4</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">Fvec</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="k">end do</span>
<span class="k">                do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">Fjac</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="o">/=</span> <span class="n">zero</span><span class="p">)</span> <span class="k">then</span>
<span class="k">                        </span><span class="nb">sum</span> <span class="o">=</span> <span class="n">zero</span>
                        <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="n">j</span><span class="p">,</span> <span class="n">m</span>
                            <span class="nb">sum</span> <span class="o">=</span> <span class="nb">sum</span> <span class="o">+</span> <span class="n">Fjac</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">Wa4</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                        <span class="k">end do</span>
<span class="k">                        </span><span class="n">temp</span> <span class="o">=</span> <span class="o">-</span><span class="nb">sum</span><span class="o">/</span><span class="n">Fjac</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
                        <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="n">j</span><span class="p">,</span> <span class="n">m</span>
                            <span class="n">Wa4</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">Wa4</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">Fjac</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">temp</span>
                        <span class="k">end do</span>
<span class="k">                    end if</span>
<span class="k">                    </span><span class="n">Fjac</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">Wa1</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                    <span class="n">Qtf</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">Wa4</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                <span class="k">end do</span>

                <span class="c">! compute the norm of the scaled gradient.</span>

                <span class="n">gnorm</span> <span class="o">=</span> <span class="n">zero</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">fnorm</span> <span class="o">/=</span> <span class="n">zero</span><span class="p">)</span> <span class="k">then</span>
<span class="k">                    do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span>
                        <span class="n">l</span> <span class="o">=</span> <span class="n">Ipvt</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">Wa2</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">/=</span> <span class="n">zero</span><span class="p">)</span> <span class="k">then</span>
<span class="k">                            </span><span class="nb">sum</span> <span class="o">=</span> <span class="n">zero</span>
                            <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span>
                                <span class="nb">sum</span> <span class="o">=</span> <span class="nb">sum</span> <span class="o">+</span> <span class="n">Fjac</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Qtf</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">/</span><span class="n">fnorm</span><span class="p">)</span>
                            <span class="k">end do</span>
<span class="k">                            </span><span class="n">gnorm</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">gnorm</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">sum</span><span class="o">/</span><span class="n">Wa2</span><span class="p">(</span><span class="n">l</span><span class="p">)))</span>
                        <span class="k">end if</span>
<span class="k">                    end do</span>
<span class="k">                end if</span>

                <span class="c">! test for convergence of the gradient norm.</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">gnorm</span> <span class="o">&lt;=</span> <span class="n">Gtol</span><span class="p">)</span> <span class="n">Info</span> <span class="o">=</span> <span class="mi">4</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">Info</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>

                    <span class="c">! rescale if necessary.</span>

                    <span class="k">if</span> <span class="p">(</span><span class="n">Mode</span> <span class="o">/=</span> <span class="mi">2</span><span class="p">)</span> <span class="k">then</span>
<span class="k">                        do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span>
                            <span class="n">Diag</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">Diag</span><span class="p">(</span><span class="n">j</span><span class="p">),</span> <span class="n">Wa2</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>
                        <span class="k">end do</span>
<span class="k">                    end if</span>

                    <span class="c">! beginning of the inner loop.</span>

                    <span class="c">! determine the levenberg-marquardt parameter.</span>

<span class="mi">25</span>                  <span class="k">call </span><span class="n">lmpar</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">Fjac</span><span class="p">,</span> <span class="n">Ldfjac</span><span class="p">,</span> <span class="n">Ipvt</span><span class="p">,</span> <span class="n">Diag</span><span class="p">,</span> <span class="n">Qtf</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">par</span><span class="p">,</span> <span class="n">Wa1</span><span class="p">,</span> <span class="n">Wa2</span><span class="p">,</span> <span class="n">Wa3</span><span class="p">,</span> <span class="n">Wa4</span><span class="p">)</span>

                    <span class="c">! store the direction p and x + p. calculate the norm of p.</span>

                    <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span>
                        <span class="n">Wa1</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">Wa1</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                        <span class="n">Wa2</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">x</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">+</span> <span class="n">Wa1</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                        <span class="n">Wa3</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">Diag</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">Wa1</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                    <span class="k">end do</span>
<span class="k">                    </span><span class="n">pnorm</span> <span class="o">=</span> <span class="n">enorm</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">Wa3</span><span class="p">)</span>

                    <span class="c">! on the first iteration, adjust the initial step bound.</span>

                    <span class="k">if</span> <span class="p">(</span><span class="n">iter</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="n">delta</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="n">pnorm</span><span class="p">)</span>

                    <span class="c">! evaluate the function at x + p and calculate its norm.</span>

                    <span class="n">iflag</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">call </span><span class="n">fcn</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">Wa2</span><span class="p">,</span> <span class="n">Wa4</span><span class="p">,</span> <span class="n">Fjac</span><span class="p">,</span> <span class="n">Ldfjac</span><span class="p">,</span> <span class="n">iflag</span><span class="p">)</span>
                    <span class="n">Nfev</span> <span class="o">=</span> <span class="n">Nfev</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">iflag</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<span class="k">                        </span><span class="n">fnorm1</span> <span class="o">=</span> <span class="n">enorm</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">Wa4</span><span class="p">)</span>

                        <span class="c">! compute the scaled actual reduction.</span>

                        <span class="n">actred</span> <span class="o">=</span> <span class="o">-</span><span class="n">one</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">p1</span><span class="o">*</span><span class="n">fnorm1</span> <span class="o">&lt;</span> <span class="n">fnorm</span><span class="p">)</span> <span class="n">actred</span> <span class="o">=</span> <span class="n">one</span> <span class="o">-</span> <span class="p">(</span><span class="n">fnorm1</span><span class="o">/</span><span class="n">fnorm</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>

                        <span class="c">! compute the scaled predicted reduction and</span>
                        <span class="c">! the scaled directional derivative.</span>

                        <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span>
                            <span class="n">Wa3</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">zero</span>
                            <span class="n">l</span> <span class="o">=</span> <span class="n">Ipvt</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                            <span class="n">temp</span> <span class="o">=</span> <span class="n">Wa1</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
                            <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span>
                                <span class="n">Wa3</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">Wa3</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">Fjac</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">temp</span>
                            <span class="k">end do</span>
<span class="k">                        end do</span>
<span class="k">                        </span><span class="n">temp1</span> <span class="o">=</span> <span class="n">enorm</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">Wa3</span><span class="p">)</span><span class="o">/</span><span class="n">fnorm</span>
                        <span class="n">temp2</span> <span class="o">=</span> <span class="p">(</span><span class="nb">sqrt</span><span class="p">(</span><span class="n">par</span><span class="p">)</span><span class="o">*</span><span class="n">pnorm</span><span class="p">)</span><span class="o">/</span><span class="n">fnorm</span>
                        <span class="n">prered</span> <span class="o">=</span> <span class="n">temp1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">temp2</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">p5</span>
                        <span class="n">dirder</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">temp1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">temp2</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

                        <span class="c">! compute the ratio of the actual to the predicted</span>
                        <span class="c">! reduction.</span>

                        <span class="n">ratio</span> <span class="o">=</span> <span class="n">zero</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">prered</span> <span class="o">/=</span> <span class="n">zero</span><span class="p">)</span> <span class="n">ratio</span> <span class="o">=</span> <span class="n">actred</span><span class="o">/</span><span class="n">prered</span>

                        <span class="c">! update the step bound.</span>

                        <span class="k">if</span> <span class="p">(</span><span class="n">ratio</span> <span class="o">&lt;=</span> <span class="n">p25</span><span class="p">)</span> <span class="k">then</span>
<span class="k">                            if</span> <span class="p">(</span><span class="n">actred</span> <span class="o">&gt;=</span> <span class="n">zero</span><span class="p">)</span> <span class="n">temp</span> <span class="o">=</span> <span class="n">p5</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">actred</span> <span class="o">&lt;</span> <span class="n">zero</span><span class="p">)</span> <span class="n">temp</span> <span class="o">=</span> <span class="n">p5</span><span class="o">*</span><span class="n">dirder</span><span class="o">/</span><span class="p">(</span><span class="n">dirder</span> <span class="o">+</span> <span class="n">p5</span><span class="o">*</span><span class="n">actred</span><span class="p">)</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">p1</span><span class="o">*</span><span class="n">fnorm1</span> <span class="o">&gt;=</span> <span class="n">fnorm</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">temp</span> <span class="o">&lt;</span> <span class="n">p1</span><span class="p">)</span> <span class="n">temp</span> <span class="o">=</span> <span class="n">p1</span>
                            <span class="n">delta</span> <span class="o">=</span> <span class="n">temp</span><span class="o">*</span><span class="nb">min</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="n">pnorm</span><span class="o">/</span><span class="n">p1</span><span class="p">)</span>
                            <span class="n">par</span> <span class="o">=</span> <span class="n">par</span><span class="o">/</span><span class="n">temp</span>
                        <span class="n">elseif</span> <span class="p">(</span><span class="n">par</span> <span class="o">==</span> <span class="n">zero</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">ratio</span> <span class="o">&gt;=</span> <span class="n">p75</span><span class="p">)</span> <span class="k">then</span>
<span class="k">                            </span><span class="n">delta</span> <span class="o">=</span> <span class="n">pnorm</span><span class="o">/</span><span class="n">p5</span>
                            <span class="n">par</span> <span class="o">=</span> <span class="n">p5</span><span class="o">*</span><span class="n">par</span>
                        <span class="k">end if</span>

                        <span class="c">! test for successful iteration.</span>

                        <span class="k">if</span> <span class="p">(</span><span class="n">ratio</span> <span class="o">&gt;=</span> <span class="n">p0001</span><span class="p">)</span> <span class="k">then</span>
                            <span class="c">! successful iteration. update x, fvec, and their norms.</span>
                            <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span>
                                <span class="n">x</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">Wa2</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                                <span class="n">Wa2</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">Diag</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                            <span class="k">end do</span>
<span class="k">                            do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">m</span>
                                <span class="n">Fvec</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">Wa4</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                            <span class="k">end do</span>
<span class="k">                            </span><span class="n">xnorm</span> <span class="o">=</span> <span class="n">enorm</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">Wa2</span><span class="p">)</span>
                            <span class="n">fnorm</span> <span class="o">=</span> <span class="n">fnorm1</span>
                            <span class="n">iter</span> <span class="o">=</span> <span class="n">iter</span> <span class="o">+</span> <span class="mi">1</span>
                        <span class="k">end if</span>

                        <span class="c">! tests for convergence.</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">actred</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">Ftol</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">prered</span> <span class="o">&lt;=</span> <span class="n">Ftol</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">p5</span><span class="o">*</span><span class="n">ratio</span> <span class="o">&lt;=</span> <span class="n">one</span><span class="p">)</span> <span class="n">Info</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">delta</span> <span class="o">&lt;=</span> <span class="n">Xtol</span><span class="o">*</span><span class="n">xnorm</span><span class="p">)</span> <span class="n">Info</span> <span class="o">=</span> <span class="mi">2</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">actred</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">Ftol</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">prered</span> <span class="o">&lt;=</span> <span class="n">Ftol</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">p5</span><span class="o">*</span><span class="n">ratio</span> <span class="o">&lt;=</span> <span class="n">one</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">Info</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="n">Info</span> <span class="o">=</span> <span class="mi">3</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">Info</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>

                            <span class="c">! tests for termination and stringent tolerances.</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">Nfev</span> <span class="o">&gt;=</span> <span class="n">Maxfev</span><span class="p">)</span> <span class="n">Info</span> <span class="o">=</span> <span class="mi">5</span>
                            <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">actred</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">epsmch</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">prered</span> <span class="o">&lt;=</span> <span class="n">epsmch</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">p5</span><span class="o">*</span><span class="n">ratio</span> <span class="o">&lt;=</span> <span class="n">one</span><span class="p">)</span> <span class="n">Info</span> <span class="o">=</span> <span class="mi">6</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">delta</span> <span class="o">&lt;=</span> <span class="n">epsmch</span><span class="o">*</span><span class="n">xnorm</span><span class="p">)</span> <span class="n">Info</span> <span class="o">=</span> <span class="mi">7</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">gnorm</span> <span class="o">&lt;=</span> <span class="n">epsmch</span><span class="p">)</span> <span class="n">Info</span> <span class="o">=</span> <span class="mi">8</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">Info</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>

                                <span class="c">! end of the inner loop. repeat if iteration unsuccessful.</span>

                                <span class="c">! end of the outer loop.</span>

                                <span class="k">if</span> <span class="p">(</span><span class="n">ratio</span> <span class="o">&gt;=</span> <span class="n">p0001</span><span class="p">)</span> <span class="k">goto </span><span class="mi">20</span>
                                <span class="k">goto </span><span class="mi">25</span>
                            <span class="k">end if</span>
<span class="k">                        end if</span>
<span class="k">                    end if</span>
<span class="k">                end if</span>
<span class="k">            end if</span>
<span class="k">        end if</span>
<span class="k">    end if</span>

<span class="c">! termination, either normal or user imposed.</span>

<span class="mi">100</span> <span class="k">if</span> <span class="p">(</span><span class="n">iflag</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">Info</span> <span class="o">=</span> <span class="n">iflag</span>
    <span class="n">iflag</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">Nprint</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">call </span><span class="n">fcn</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Fvec</span><span class="p">,</span> <span class="n">Fjac</span><span class="p">,</span> <span class="n">Ldfjac</span><span class="p">,</span> <span class="n">iflag</span><span class="p">)</span>

    <span class="k">end subroutine </span><span class="n">lmder</span>
</pre></div>

    </section>
    <br>
    
    
    </div>
  </div>


    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-6"><p>minpack was developed by Jacob Williams<br>&copy; 2021 
                                          </p>
        </div>
        <div class="col-xs-6 col-md-6">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/Fortran-FOSS-Programmers/ford">FORD</a>
            
            
          </p>
        </div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
    
  </body>
</html>